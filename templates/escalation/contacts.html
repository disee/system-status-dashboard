{% extends "base/base.html" %}

{% comment %}

 Copyright 2013 - Tom Alessi

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and 
 limitations under the License.

{% endcomment %}

{% block content %}

<script>
  // Set edit style to inline instead of popup
  $.fn.editable.defaults.mode = 'popup';
</script>

<div class="row">
  {# This is a large-3 side nav #}
  {% include "admin/side_nav.html" %}

  <div class="large-9 columns">

    <div class="row">
      <div class="large-12 columns">
        <h4>Escalation Path Configuration</h4>
        <p>If you would like to display escalation contacts as part of your dashboard configuration, complete the relevant fields below.</p>
        <hr>
      </div>
    </div>

    {# This is row consisting of 12 columns that will display all messages passed in the request #}
    {% include "admin/messages.html" %}

    <div class="row">
      <div class="large-12 columns">
        <span class="radius secondary label">Current Contacts and Order</span><br><br>
      </div>
    </div>

    <div class="row">
      <div class="large-12 columns">
        {% if contacts %}
        <table>
          <tr>
           <th>Order</th>
           <th>Name</th>
           <th>Details</th>
           <th>Up/Down</th>
           <th>Show/Hide</th>
           <th>Delete</th>
          </tr>
          {% for row in contacts %}
          <tr>
            <td>{{row.order}}</td>
            <td>
              <span>
                <a href="#" title="Modify contact name" id="name_{{row.id}}">{{row.name}}</a>
                <script>
                $(document).ready(function() {
                  $('#name_{{row.id}}').editable({
                        url: '/admin/contact_modify',
                        type: 'text',
                        pk: '{{row.id}}',
                        name: 'name',
                        inputclass: 'x_editable_text',
                        params: { csrfmiddlewaretoken: '{{csrf_token}}'},
                        error: function(response, newValue) {
                          return response.responseText;
                        }
                    });
                });
                </script>
              </span>
            </td>

            <td>
              <span>
                <a href="#" title="Modify contact details" id="details_{{row.id}}">{{row.contact_details|linebreaksbr}}</a>
                <script>
                $(document).ready(function() {
                  $('#details_{{row.id}}').editable({
                        url: '/admin/contact_modify',
                        type: 'textarea',
                        pk: '{{row.id}}',
                        name: 'contact_details',
                        inputclass: 'x_editable_contact',
                        params: { csrfmiddlewaretoken: '{{csrf_token}}'},
                        error: function(response, newValue) {
                          return response.responseText;
                        }
                    });
                });
                </script>
              </span>
            </td>
            <td>
              <a href="/admin/contact_switch?id={{row.id}}&action=up" title="move up"><div class="genericon genericon-uparrow genericon_container"></div></a>
              <br>
              <a href="/admin/contact_switch?id={{row.id}}&action=down" title="move down"><div class="genericon genericon-downarrow genericon_container"></div></a>
            </td>
            <td class="genericon_container">
             {% if row.hidden %}
              <a href="/admin/contact_switch?id={{row.id}}&action=show" title="show"><div class="genericon genericon-hide genericon_container"></div></a>
             {% else %}
              <a href="/admin/contact_switch?id={{row.id}}&action=hide" title="hide"><div class="genericon genericon-show genericon_container"></div></a>
             {% endif %}
            </td>
            <td class="genericon_container">
              <a href="/admin/contact_delete?id={{row.id}}"><div class="genericon genericon-trash genericon_container"></div></a>
            </td>
          </tr>
          {% endfor %}
        </table>      
        {% else %}
        <b>No contacts defined</b>
        <br>
        {% endif %}
      </div>
    </div>

    <div class="spacer_medium"></div>

    <form method="POST" action="/admin/escalation_contacts">
    {% csrf_token %}
    <div class="row">
      <div class="large-12 columns {% if form.service.errors %}error{% endif %}">
        <span class="radius secondary label">Add Escalation Contacts</span><br>
        <div class="sublabel_container"><span class="sublabel">Escalation contacts added here can be shown/hidden on the escalation contacts page.  Contacts are initially created in a hidden state so you will need to show them after creation.  You are permitted to enter up to 10 escalation contacts (shown + hidden)</span></div>
      </div>
    </div>

    <div class="row">
      <div class="large-12 columns">
       <label>Full Name</label>
      </div>
    </div>

    <div class="row">
      <div class="large-8 columns {% if form.name.errors %}error{% endif %}">
        <input name="name" type="text" value="{% if form.name.data %}{{form.name.data}}{% endif %}" placeholder="Enter the contact name">
        {% if form.name.errors %}
        <small class="error">
          {% for error in form.name.errors %}{{error}}{% endfor %}
        </small>
        {% endif %}
      </div>
    </div>

    <div class="row">
      <div class="large-12 columns">
       <label>Contact Details</label>
      </div>
    </div>
          
    <div class="row">
      <div class="large-8 columns {% if form.contact_details.errors %}error{% endif %}">
        <textarea name="contact_details" placeholder="Enter contact details">{% if form.contact_details.data %}{{form.contact_details.data}}{% endif %}</textarea>
        {% if form.contact_details.errors %}
        <small class="error">
          {% for error in form.contact_details.errors %}{{error}}{% endfor %}
        </small>
        {% endif %}
      </div>
    </div>
         
    <div class="row">
      <div class="large-12 columns">
        <input type="submit" class="small button secondary" value="add"/>
      </div>
    </div>
    </form> 

  </div>
</div>


{% endblock %}